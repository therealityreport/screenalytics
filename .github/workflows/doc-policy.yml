name: doc-policy
on:
  pull_request:
    paths: ["**/*.md","FEATURES/**","docs/**"]
jobs:
  check-doc-paths:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Validate doc policy
        run: |
          python - <<'PY'
          import os, subprocess, sys
          base = os.getenv('GITHUB_BASE_REF', 'origin/main')
          changed = subprocess.check_output(["git","diff","--name-only",f"{base}..HEAD"]).decode().splitlines()
          promotion = os.getenv("DOC_PROMOTION_MODE","false").lower() == "true"
          errs = []
          for path in changed:
            if path.endswith(".md") and path.startswith("docs/") and not promotion:
              errs.append(f"Root docs change blocked pre-promotion: {path}")
          if errs:
            print("\n".join(errs))
            sys.exit(1)
          print("Doc path policy passed.")
          PY

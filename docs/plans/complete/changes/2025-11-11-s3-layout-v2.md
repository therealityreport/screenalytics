# 2025-11-11 â€” Hierarchical S3 layout for episode videos

## Highlights
- Episode videos now write to `raw/videos/{show_slug}/s{season}/e{episode}/episode.mp4` ("v2" layout) when presigned/uploaded from the UI or API.
- Mirror/download logic first tries the v2 key, then falls back to the legacy v1 key (`raw/videos/{ep_id}/episode.mp4`) so older objects keep working.
- `/episodes/{ep_id}` and `/episodes/s3_videos` expose both paths so operators can see which layout is populated, and a migration script (`scripts/s3_migrate_v1_to_v2.py`) can copy v1 objects into the new hierarchy.

## Why it matters
Organizing by show/season/episode matches how footage lives in other systems, avoids huge flat prefixes, and makes it easier to reason about S3 ACLs/lifecycle rules without breaking existing data.

## How to use it
- Uploads/presigns automatically target the v2 path; the UI highlights the key.
- If you only have a v1 object, mirroring/detect-track still works, but the Episode Detail page shows a warning until you migrate.
- Run `scripts/s3_migrate_v1_to_v2.py --apply` to copy existing v1 objects to the new layout (dry-run by default).

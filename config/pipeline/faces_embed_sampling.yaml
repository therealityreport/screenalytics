# Face embedding sampling configuration for Bravo 24fps episodes
# This controls how many samples per track get embedded/exported,
# independent of detection/tracking which runs on every frame.

# Quality gating thresholds
# These control which faces are accepted for embedding based on quality metrics
# NOTE: Relaxed settings to include smaller/lower-quality faces that may be cast members
quality_gating:
  # Combined quality score threshold (0.0-10.0, higher = stricter)
  # Quality score combines: blur + contrast + face size
  # Lowered from 3.0 to 1.5 to include more faces
  min_quality_score: 1.5

  # Individual component thresholds
  min_confidence: 0.45      # Detection confidence (0.0-1.0) - lowered from 0.60
  min_blur_score: 15.0      # Laplacian variance (higher = sharper) - lowered from 35.0
  min_std: 0.5              # Image standard deviation (contrast) - lowered from 1.0

  # Pose filtering (degrees) - relaxed to include more profile shots
  max_yaw_angle: 60.0       # Maximum head rotation (left/right) - was 45.0
  max_pitch_angle: 45.0     # Maximum head tilt (up/down) - was 30.0

  # Expression filtering (list of allowed expressions, or empty for all)
  # Empty list = allow all expressions
  allowed_expressions: []

  # Sampling strategy: "uniform", "quality_weighted", "stratified"
  sampling_mode: "quality_weighted"

limits:
  default:
    max_samples_per_track: 5
    min_samples_per_track: 3
    sample_every_n_frames: 4
    min_frames_between_crops: 32
    max_faces_per_episode: 10000
  profiles:
    fast_cpu:
      max_samples_per_track: 3
      min_samples_per_track: 2
      min_frames_between_crops: 48
      max_faces_per_episode: 6000
    low_power:
      max_samples_per_track: 3
      min_samples_per_track: 2
      min_frames_between_crops: 48
      max_faces_per_episode: 6000
    balanced:
      max_samples_per_track: 3
      min_samples_per_track: 2
      min_frames_between_crops: 32
      max_faces_per_episode: 8000
    high_accuracy:
      max_samples_per_track: 8
      min_samples_per_track: 4
      min_frames_between_crops: 24
      max_faces_per_episode: 20000

detect_track_presets:
  bravo_24fps_default:
    # Detection/tracking runs on EVERY frame (stride=1)
    detector_frame_stride: 1

    # Per-track sampling for embedding/export
    faces_embed_sampling:
      max_samples_per_track: 16  # Hard cap per track
      min_samples_per_track: 4   # Minimum if track is long enough
      sample_every_n_frames: 4   # Fallback interval for uniform sampling

      # Export controls
      save_frames: false          # Don't export full frames by default
      save_crops: true            # Export crops for sampled faces only
